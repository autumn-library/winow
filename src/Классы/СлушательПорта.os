Перем Настройки;
Перем ТСПСервер;
Перем Активен;

&Желудь
Процедура ПриСозданииОбъекта(
							&Пластилин("Настройки") _Настройки
							)

	Настройки = _Настройки;		
	Активен = Ложь;
КонецПроцедуры

Процедура Запустить() Экспорт

	Если Не Активен() Тогда
		ТСПСервер = Новый TCPСервер(Настройки.Порт);
		ТСПСервер.Запустить();
		Активен = Истина;
	Иначе
		ВызватьИсключение "Серевер уже запущен";
	КонецЕсли;	

КонецПроцедуры

Функция Активен() Экспорт
	Возврат Активен;
КонецФункции

Процедура Остановить() Экспорт
	Если НЕ Активен() Тогда
		ВызватьИсключение "Серевер не запущен";
	Иначе
		ТСПСервер.Остановить();
		ТСПСервер = Неопределено;
		Активен = Ложь;
	КонецЕсли;	
КонецПроцедуры

Функция ОжидатьСоединения() Экспорт
	Если НЕ Активен() Тогда
		ВызватьИсключение "Серевер не запущен";
	Иначе
		Возврат ТСПСервер.ОжидатьСоединения();
	КонецЕсли;	
КонецФункции